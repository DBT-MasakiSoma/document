 - name: Upload PDFs to Box
        run: |
          echo "Uploading PDFs to Box..."
          BOX_ACCESS_TOKEN=${{ secrets.BOX_ACCESS_TOKEN }}
          BOX_FOLDER_ID=${{ secrets.BOX_FOLDER_ID }}
          for file in output_pdfs/*.pdf; do
            if [ -f "$file" ]; then
              filename=$(basename "$file")
              echo "Processing: $filename"
              # API_RESPONSE取得
              API_RESPONSE=$(curl -s -w "%{http_code}" -o /tmp/box_response.json -X GET \
                "https://api.box.com/2.0/folders/${BOX_FOLDER_ID}/items?fields=id,name" \
                -H "Authorization: Bearer ${BOX_ACCESS_TOKEN}")
              # HTTP_STATUS取得
              HTTP_STATUS=$(echo "$API_RESPONSE" | tail -n1)
              # HTTP_STATUSが200以外場合，エラー
              if [[ "$HTTP_STATUS" -ne 200 ]]; then
                echo "Error: Box API request failed with status code: $HTTP_STATUS"
                cat /tmp/box_response.json  # responseを出力
                exit 1
              fi
              # FILE_ID取得
              FILE_ID=$(jq -r --arg fname "$filename" '.entries[] | select(.name==$fname) | .id' /tmp/box_response.json)
              # ファイル存在する場合、上書き保存
              if [ -n "$FILE_ID" ]; then
                echo "File exists (ID: $FILE_ID), overwriting..."
                UPLOAD_RESPONSE=$(curl -s -w "%{http_code}" -o /tmp/box_upload_response.json -X POST \
                  "https://upload.box.com/api/2.0/files/${FILE_ID}/content" \
                  -H "Authorization: Bearer ${BOX_ACCESS_TOKEN}" \
                  -H "Content-Type: multipart/form-data" \
                  -F file=@"${file}")
                UPLOAD_STATUS=$(echo "$UPLOAD_RESPONSE" | tail -n1)
                if [[ "$UPLOAD_STATUS" -ne 200 ]]; then
                  echo "Error: Upload failed with status code: $UPLOAD_STATUS"
                  cat /tmp/box_upload_response.json
                  exit 1
                fi
              # ファイル存在しない場合、アップロート
              else
                echo "File does not exist, uploading..."
                JSON_ATTR="{\"name\":\"${filename}\", \"parent\": {\"id\": \"${BOX_FOLDER_ID}\"}}"
                UPLOAD_RESPONSE=$(curl -s -w "%{http_code}" -o /tmp/box_upload_response.json -X POST \
                  "https://upload.box.com/api/2.0/files/content" \
                  -H "Authorization: Bearer ${BOX_ACCESS_TOKEN}" \
                  -H "Content-Type: multipart/form-data" \
                  -F attributes="${JSON_ATTR}" \
                  -F file=@"${file}")
                UPLOAD_STATUS=$(echo "$UPLOAD_RESPONSE" | tail -n1)
                if [[ "$UPLOAD_STATUS" -ne 200 ]]; then
                  echo "Error: Upload failed with status code: $UPLOAD_STATUS"
                  cat /tmp/box_upload_response.json
                  exit 1
                fi
              fi
            fi
          done
